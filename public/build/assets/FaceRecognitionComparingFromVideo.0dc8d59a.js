import{l as v,a as u,b as h,c as g,o,p,e as f,m as w,r as y,f as C,g as x,h as _}from"./resizeResults.444d9345.js";import{f as n}from"./fetchImage.70bf5102.js";import{n as D}from"./_plugin-vue2_normalizer.358ffe07.js";import"./bufferToImage.93eb654c.js";const F={data(){return{videoStream:null,imagenCapturada:null,capturada:null,isStreaming:null,intervalo:null}},async mounted(){let e="/models/";await v(e),await u(e),await h(e),await g(e),navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{const t=this.$refs.video;t.srcObject=a,t.play(),this.videoStream=a}).catch(a=>{console.error(a)}),this.intervalo=setInterval(async()=>{await this.onPlay()},100)},methods:{async captureImage(){const e=this.$refs.video,a=this.$refs.canvas,t=a.getContext("2d"),s=e.offsetWidth,i=e.offsetHeight;a.width=s,a.height=i,t.drawImage(e,0,0,s,i);const r=a.toDataURL("image/png"),c=await n("/images/saved/image1.jpg"),l=await n(r),d=await o(c);console.log("savedDescriptor");const m=await o(l);p(d,m)<6e-4?console.log("El rostro capturado coincide con la imagen guardada"):console.log("El rostro capturado no coincide con la imagen guardada"),this.stopVideo()},async onPlay(){const e=this.$refs.video,a=this.$refs.canvas;let t=await f(e).withFaceLandmarks().withFaceDescriptors().withFaceExpressions();const s=w(a,e,!0),i=y(t,s);C(a,i),x(a,i),_(a,i,.05)},newCaptureImage(){this.capturada=!1,this.imagenCapturada="",this.startVideo(),this.clearCanvas()},async startVideo(){let e=this.$refs.video;if(navigator.mediaDevices.getUserMedia)try{this.isStreaming=!0,e.srcObject=await navigator.mediaDevices.getUserMedia({video:!0})}catch(a){console.log(a),this.isStreaming=!1}},stopVideo(){const e=this.$refs.video;clearInterval(this.intervalo),e.srcObject.getTracks().forEach(function(s){s.stop()}),e.srcObject=null,this.isStreaming=!1,this.clearCanvas()},clearCanvas(){const e=this.$refs.canvas;e.width=0,e.height=0;let a=e.getContext("2d");a.fillRect(0,0,e.width,e.height),a.clearRect(0,0,e.width,e.height)}},beforeDestroy(){this.videoStream&&this.videoStream.getTracks().forEach(e=>{e.stop()})}};var S=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"d-flex justify-center align-center mb-2 rounded-lg",class:{"d-none":!a.isStreaming},staticStyle:{position:"relative","min-width":"640px"}},[a.capturada?t("img",{staticClass:"rounded mx-auto elevation-6",attrs:{src:a.imagenCapturada,alt:""}}):a._e(),t("video",{ref:"video",staticClass:"rounded mx-auto elevation-6",attrs:{autoplay:""},on:{loadedmetadata:function(s){return a.onPlay()}}}),t("canvas",{ref:"canvas",staticStyle:{position:"absolute",left:"0",right:"0",margin:"auto","z-index":"20"}})]),t("div",{staticClass:"d-flex justify-center align-center justify-space-between mx-auto",staticStyle:{"max-width":"640px"}},[t("v-btn",{staticClass:"primary",on:{click:a.captureImage}},[a._v("Registrar Asistencia")]),t("v-btn",{staticClass:"secondary",on:{click:a.newCaptureImage}},[a._v("Nueva Captura")])],1)])},b=[],I=D(F,S,b,!1,null,null,null,null);const E=I.exports;export{E as default};
