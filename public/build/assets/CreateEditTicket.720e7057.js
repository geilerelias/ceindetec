import{A as a}from"./AppLayout.7e6a42a7.js";import{B as l}from"./BreadCrumbs.14245490.js";import{V as n}from"./vue2-editor.esm.e0ba3048.js";import{n as m}from"./_plugin-vue2_normalizer.358ffe07.js";import"./Footer.69c5493d.js";import"./app.77aa44cf.js";import"./logo-ceindetec.0997e866.js";import"./Logo.5a18e3f9.js";import"./SettingsDropdown.da80baee.js";const c={name:"CreateTicket",components:{BreadCrumbs:l,AppLayout:a,VueEditor:n},props:{ticket:Object,editMode:{type:Boolean,default:!1}},data(){return{form:this.$inertia.form({user_id:"",category_id:"",title:"",priority:"",message:"",status:"Open",resource:"",line:"",resources:[],establishment_id:"",headquarter_id:"",published_at:""}),lines:[{name:"Conectividad",icon:"mdi-radio-tower"},{name:"Paneles Solares",icon:"mdi-solar-power-variant "},{name:"Hidropaneles",icon:"mdi-solar-panel"}],links:[{text:"Dashboard",disabled:!1,href:"/dashboard"},{text:"Tickets",disabled:!1,href:"/dashboard/ticket"},{text:this.modeName,disabled:!0,href:""}],establishments:[],headquarters:[],priorities:[{name:"Alta",icon:"mdi-arrow-up-bold"},{name:"Media",icon:"mdi-format-vertical-align-center"},{name:"Baja",icon:"mdi-arrow-down-bold"}],categories:[],menu2:null,modeName:""}},created(){axios.get("/dashboard/establishment/all").then(s=>{this.establishments=s.data}),axios.get("/dashboard/ticket-category/all").then(s=>{this.categories=s.data}),this.editMode===!0&&this.$nextTick(()=>{this.form.reset(),this.form=this.$inertia.form(this.ticket),this.getAllHeadquarters()}),this.modeName=`${this.isEdit!==!1?"Modificar ":"Abrir"} Ticket`},watch:{modeName(s){this.links[2].text=s}},computed:{filteredCategories(){return this.categories.filter(s=>s.line===this.form.line)},isEdit(){return this.editMode}},methods:{regresar(){this.$inertia.get("/dashboard/ticket")},submitForm(){this.isEdit?this.edit():this.save()},save:function(){try{this.form.post("/dashboard/ticket",{forceFormData:!0,onSuccess:s=>{console.log(s),this.$swal("Buen trabajo",s.props.flash.message,"success"),this.$inertia.visit(route("ticket.index"))},onError:s=>{console.log("errors",s);let e=Object.values(s).join("<br>");this.$swal({icon:"error",title:"Ups...",html:e})}})}catch(s){console.log(s)}},edit:function(){try{this.form._method="PUT",console.log("hasta aqui"),this.$inertia.post(`/dashboard/ticket/${this.form.id}`,this.form,{forceFormData:!0,onSuccess:s=>{this.$swal("Buen trabajo!",s.props.flash.message,"success")},onError:s=>{this.form=this.form.setError(s);let e=Object.values(s).join("<br>");this.$swal({icon:"error",title:"Ups...",html:e})}})}catch(s){console.log(s)}},reset(){this.$refs.form.resetValidation(),this.$refs.form.reset(),this.form.reset()},getAllHeadquarters(){let s=this.form.establishment_id;console.log(this.form.establishment_id),console.log(s),s!==null&&axios.get(`/dashboard/establishment/${s}/headquarters`).then(e=>{this.headquarters=e.data}).catch(e=>{console.log(e)})}}};var d=function(){var e=this,t=e._self._c;return t("app-layout",[t("bread-crumbs",{attrs:{items:e.links,name:e.modeName}}),t("v-container",[t("v-col",{staticClass:"mx-auto col-md-10 cols-12"},[t("v-form",{ref:"form",attrs:{enctype:"multipart/form-data"},on:{submit:function(r){return r.preventDefault(),e.submitForm()}}},[t("v-card",[t("v-card-text",[t("v-row",[t("v-col",{staticClass:"col-sm-12 col-md-6"},[t("v-text-field",{attrs:{value:e.$page.props.user.name,disabled:"",label:"Nombre",outlined:"",readonly:""}})],1),t("v-col",{staticClass:"col-sm-12 col-md-6"},[t("v-text-field",{attrs:{value:e.$page.props.user.email,disabled:"",label:"Direcci\xF3n de email",outlined:"",readonly:""}})],1),t("v-col",{staticClass:"col-12 col-sm-6"},[t("v-autocomplete",{attrs:{disabled:e.establishments.length<-1,"error-messages":e.form.errors.establishment_id,items:e.establishments,readonly:e.establishments.length<-1,"item-text":"name","item-value":"id",label:"Establecimiento",outlined:""},on:{blur:function(r){return e.form.clearErrors("establishment_id")},change:e.getAllHeadquarters},model:{value:e.form.establishment_id,callback:function(r){e.$set(e.form,"establishment_id",r)},expression:"form.establishment_id"}})],1),t("v-col",{staticClass:"col-12 col-sm-6"},[t("v-autocomplete",{attrs:{disabled:e.headquarters.length<-1,"error-messages":e.form.errors.headquarter_id,items:e.headquarters,readonly:e.form.establishment_id===null||e.form.establishment_id==="","item-text":"name","item-value":"id",label:"Sede",outlined:""},on:{blur:function(r){return e.form.clearErrors("headquarter_id")}},model:{value:e.form.headquarter_id,callback:function(r){e.$set(e.form,"headquarter_id",r)},expression:"form.headquarter_id"}})],1),t("v-col",{staticClass:"col-sm-12 col-md-5"},[t("v-autocomplete",{attrs:{"error-messages":e.form.errors.line,items:e.lines,"item-text":"name","item-value":"name",label:"Linea a la cual pertenece la operaci\xF3n",outlined:""},on:{blur:function(r){return e.form.clearErrors("line")}},scopedSlots:e._u([{key:"item",fn:function(r){return[typeof r.item!="object"?[t("v-list-item-content",{domProps:{textContent:e._s(r.item)}})]:[t("v-list-item-avatar",[t("v-icon",[e._v(" "+e._s(r.item.icon)+" ")])],1),t("v-list-item-title",{domProps:{innerHTML:e._s(r.item.name)}})]]}}]),model:{value:e.form.line,callback:function(r){e.$set(e.form,"line",typeof r=="string"?r.trim():r)},expression:"form.line"}})],1),t("v-col",{staticClass:"col-sm-12 col-md-4"},[t("v-autocomplete",{attrs:{disabled:e.form.line===""||e.form.line===null,"error-messages":e.form.errors.category_id,items:e.filteredCategories,"item-text":"name","item-value":"id",label:"Categor\xEDa",outlined:""},on:{blur:function(r){return e.form.clearErrors("category_id")}},model:{value:e.form.category_id,callback:function(r){e.$set(e.form,"category_id",r)},expression:"form.category_id"}})],1),t("v-col",{staticClass:"col-sm-12 col-md-3"},[t("v-autocomplete",{attrs:{"error-messages":e.form.errors.priority,items:e.priorities,"item-text":"name","item-value":"name",label:"Prioridad",outlined:""},on:{blur:function(r){return e.form.clearErrors("priority")}},scopedSlots:e._u([{key:"item",fn:function(r){return[typeof r.item!="object"?[t("v-list-item-content",{domProps:{textContent:e._s(r.item)}})]:[t("v-list-item-avatar",[t("v-icon",[e._v(" "+e._s(r.item.icon)+" ")])],1),t("v-list-item-title",{domProps:{innerHTML:e._s(r.item.name)}})]]}}]),model:{value:e.form.priority,callback:function(r){e.$set(e.form,"priority",r)},expression:"form.priority"}})],1),t("v-col",{staticClass:"col-sm-12 col-md-12"},[t("v-text-field",{attrs:{"error-messages":e.form.errors.title,label:"Titulo",outlined:""},on:{blur:function(r){return e.form.clearErrors("title")}},model:{value:e.form.title,callback:function(r){e.$set(e.form,"title",r)},expression:"form.title"}})],1),t("v-col",{staticClass:"col-sm-12 col-md-12"},[t("v-input",{attrs:{label:"Mensaje"}}),t("vue-editor",{ref:"myTextEditor",staticClass:"theme--light v-text-field v-text-field--is-booted v-text-field--enclosed v-text-field--outlined",style:e.form.errors.message?"border:solid 2px red; border-radius: 4px":"border-radius: 6px",attrs:{outlined:"",placeholder:"Mensaje del ticket"},on:{blur:function(r){return e.form.clearErrors("message")}},model:{value:e.form.message,callback:function(r){e.$set(e.form,"message",r)},expression:"form.message"}}),t("v-input",{attrs:{"error-messages":e.form.errors.message}})],1),t("v-col",{staticClass:"col-12 col-sm-4"},[t("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,"min-width":"auto","offset-y":"",transition:"scale-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:o}){return[t("v-text-field",e._g(e._b({attrs:{"error-messages":e.form.errors.published_at,label:"Fecha de apertura",outlined:"","prepend-inner-icon":"mdi-calendar",readonly:""},on:{blur:function(i){return e.form.clearErrors("published_at")}},model:{value:e.form.published_at,callback:function(i){e.$set(e.form,"published_at",i)},expression:"form.published_at"}},"v-text-field",o,!1),r))]}}]),model:{value:e.menu2,callback:function(r){e.menu2=r},expression:"menu2"}},[t("v-date-picker",{attrs:{label:"Fecha",locale:"es-Co",outlined:"",required:""},on:{input:function(r){e.menu2=!1}},model:{value:e.form.published_at,callback:function(r){e.$set(e.form,"published_at",r)},expression:"form.published_at"}})],1)],1),t("v-col",{staticClass:"col-12 col-sm-8"},[t("v-file-input",{attrs:{"prepend-icon":null,"show-size":1e3,color:"primary",counter:"",label:"Adjuntar archivos",multiple:"",outlined:"","prepend-inner-icon":"mdi-paperclip"},scopedSlots:e._u([{key:"selection",fn:function({index:r,text:o}){return[t("v-chip",{attrs:{color:"secondary",dark:"",label:"",small:""}},[e._v(" "+e._s(o)+" ")])]}}]),model:{value:e.form.resources,callback:function(r){e.$set(e.form,"resources",r)},expression:"form.resources"}}),e._v(" "+e._s(e.form.resources)+" ")],1)],1)],1),t("v-card-actions",{staticClass:"d-flex justify-center align-center"},[t("v-btn",{attrs:{loading:e.form.processing,color:"primary",type:"submit"}},[e._v(" "+e._s(e.isEdit?"Actualizar":"Crear")+" ")]),t("v-btn",{staticClass:"secondary",on:{click:function(r){return e.regresar()}}},[e._v(" Cancelar ")])],1)],1)],1)],1)],1)],1)},u=[],f=m(c,d,u,!1,null,"21896cb4",null,null);const $=f.exports;export{$ as default};
